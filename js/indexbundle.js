(()=>{"use strict";const e="https://wooden-dour-pea.glitch.me/";let t={month:(new Date).getMonth(),year:(new Date).getFullYear()};const n=e=>new Intl.NumberFormat("en",{style:"decimal",maximumFractionDigits:2}).format(e),i={form:document.querySelector("#budget-form"),type:document.querySelector("#input__type"),description:document.querySelector("#input__description"),value:document.querySelector("#input__value"),incomeList:document.querySelector("#income__list"),expensesList:document.querySelector("#expenses__list"),budgetValue:document.querySelector("#budget-value"),table:document.querySelector(".budget-section"),infoBoxIncome:document.querySelector(".info-box--income .info-box__value"),infoBoxExpenses:document.querySelector(".info-box--expenses .info-box__value"),infoBoxPercents:document.querySelector(".info-box__percents .badge"),budgetValue:document.querySelector("#budget-value"),inputMonth:document.querySelector("#input__month"),inputYear:document.querySelector("#input__year"),historyForm:document.querySelector("#history-form"),currentBtn:document.querySelector("#current-btn"),month:document.querySelector("#month"),year:document.querySelector("#year")},o=e=>{i.inputMonth.value=e.month,i.inputYear.value=e.year},r=e=>{i.type.value=e.type,i.description.value=e.description,i.value.value=e.value};class a{constructor(e,t,n){this.type=e,this.description=t,this.value=n}}const c=[new a("inc","Зарплата","100000"),new a("exp","Рента","30000"),new a("inc","Партнерка","10000"),new a("exp","Бензин","1000"),new a("inc","Продажи","10000"),new a("exp","Покупки","2000"),new a("inc","Инвест. доход","5000"),new a("exp","Развлечения","2000"),new a("inc","Фриланс","20000"),new a("exp","Коммунальные счета","1000"),new a("exp","Спортзал","2000")];function s(){const e=(t=c,Math.floor(Math.random()*t.length));var t;return c[e]}const l=e=>{var n;e.preventDefault(),n={month:i.inputMonth.value,year:i.inputYear.value},t.month=n.month,t.year=n.year,p()},u=()=>{t.month=(new Date).getMonth(),t.year=(new Date).getFullYear(),o(t),p()},m=async t=>{t.preventDefault();const n=new FormData(i.form);await(async t=>{const n={type:t.get("type"),description:t.get("description"),value:t.get("value"),month:(new Date).getMonth(),year:(new Date).getFullYear()};await fetch(e+"items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})})(n),await p(),i.form.reset(),r(s())},d=async t=>{if("delete"==t.target.getAttribute("alt")){const n=t.target.closest("li").id.split("-")[1];await(async t=>{await fetch(e+"items/"+t,{method:"DELETE"})})(n),await p()}},p=async()=>{const o=await(async()=>{const i=await(async()=>await fetch(e+"items").then((e=>e.json())).then((e=>e)))(),o=(e=>e.filter((e=>e.year==t.year)).filter((e=>e.month==t.month)))(i);return(e=>{const t=e.filter((e=>"inc"==e.type)),i=e.filter((e=>"exp"==e.type)),o=e.filter((e=>"inc"==e.type)).reduce(((e,t)=>e+parseFloat(t.value)),0),r=e.filter((e=>"exp"==e.type)).reduce(((e,t)=>e+parseFloat(t.value)),0),a=0!==o?(100*r/o).toFixed(1)+" %":"-",c=t.map((e=>({...e,value:n(e.value)}))),s=i.map((e=>({...e,value:n(e.value),persentage:(100*e.value/r).toFixed(1)}))),l=o-r>0?"+"+n(o-r):n(o-r);return{income:c,expence:s,totalIncomes:0!=o?"+ "+n(o):"0",totalExpences:0!=r?"- "+n(r):"0",expencesPercentage:a,budgetValue:l}})(o)})();(e=>{(e=>{i.incomeList.innerHTML="";let t="";e.forEach((e=>{t+=`<li\n                        id="income-${e.id}"\n                        class="budget-list__item item item--income"\n                    >\n                        <div class="item__title">${e.description}</div>\n                        <div class="item__right">\n                            <div class="item__amount">+ ${e.value}</div>\n                            <button class="item__remove">\n                                <img\n                                    src="./img/circle-green.svg"\n                                    alt="delete"\n                                />\n                            </button>\n                        </div>\n                    </li>`})),i.incomeList.insertAdjacentHTML("beforeend",t)})(e.income),(e=>{i.expensesList.innerHTML="";let t="";e.forEach((e=>{t+=`<li\n                    id="expense-${e.id}"\n                    class="budget-list__item item item--expense"\n                >\n                    <div class="item__title">${e.description}</div>\n                    <div class="item__right">\n                        <div class="item__amount">\n                            - ${e.value}\n                            <div class="item__badge">\n                                <div class="badge badge--dark">${e.persentage}%</div>\n                            </div>\n                        </div>\n                        <button class="item__remove">\n                            <img src="./img/circle-red.svg" alt="delete" />\n                        </button>\n                    </div>\n                </li>`})),i.expensesList.insertAdjacentHTML("beforeend",t)})(e.expence)})(o),((e,t)=>{i.month.innerText=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e.month],i.year.innerText=e.year,i.infoBoxIncome.innerText=t.totalIncomes,i.infoBoxExpenses.innerText=t.totalExpences,i.infoBoxPercents.innerText=t.expencesPercentage,i.budgetValue.innerText=t.budgetValue})(t,o)};(async()=>{r(s()),o(t),await p(),i.form.addEventListener("submit",m),i.table.addEventListener("click",d),i.historyForm.addEventListener("submit",l),i.currentBtn.addEventListener("click",u)})()})();